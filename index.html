<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>¬°Reto de Multiplicaciones! (1‚Äì12)</title>
  <!-- Tailwind CSS desde CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark">
  <style>
    /* Peque√±as mejoras visuales adicionales */
    .bubble {
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
    }
    .pop {
      animation: pop .25s ease-out;
    }
    @keyframes pop {
      0% { transform: scale(.96); }
      100% { transform: scale(1); }
    }
    .shake {
      animation: shake .35s cubic-bezier(.36,.07,.19,.97) both;
    }
    @keyframes shake {
      10%, 90% { transform: translateX(-2px); }
      20%, 80% { transform: translateX(4px); }
      30%, 50%, 70% { transform: translateX(-6px); }
      40%, 60% { transform: translateX(6px); }
    }
    .confetti {
      position: absolute; inset: 0; pointer-events: none; overflow: hidden;
    }
    .confetti > i {
      position: absolute; width: 10px; height: 14px; opacity: .9;
      top: -20px; transform: rotate(15deg);
      animation: fall 1.2s linear forwards;
    }
    @keyframes fall {
      to { transform: translateY(120vh) rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-indigo-100 via-sky-100 to-emerald-100 dark:from-slate-900 dark:via-slate-900/90 dark:to-slate-900 text-slate-900 dark:text-slate-100">
  <main class="max-w-4xl mx-auto px-4 py-8 sm:py-12">
    <header class="text-center mb-8 sm:mb-12">
      <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight">
        üß†‚ú® Reto de <span class="text-indigo-600 dark:text-indigo-400">Multiplicaciones</span>
      </h1>
      <p class="mt-3 text-lg sm:text-xl opacity-90">Practica tablas del <strong>1 al 12</strong> con un dise√±o grande y divertido.</p>
    </header>

    <!-- Panel principal -->
    <section class="relative bubble rounded-3xl bg-white/80 dark:bg-white/5 backdrop-blur p-5 sm:p-8">
      <div id="confetti" class="confetti"></div>

      <!-- Controles superiores -->
      <div class="flex flex-col md:flex-row items-stretch gap-3 md:items-center md:justify-between mb-6">
        <div class="flex items-center gap-3">
          <span class="text-base sm:text-lg">Modo:</span>
          <div class="flex gap-2">
            <button id="modo-aleatorio" class="px-4 py-2 rounded-full text-base sm:text-lg font-bold bg-indigo-600 text-white hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-indigo-400">Aleatorio</button>
            <button id="modo-tabla" class="px-4 py-2 rounded-full text-base sm:text-lg font-bold bg-emerald-600 text-white hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-emerald-400">Elegir tabla</button>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button id="btn-reset" class="px-4 py-2 rounded-full text-base sm:text-lg font-semibold bg-rose-600 text-white hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-rose-400" title="Reiniciar contadores">Reiniciar</button>
          <button id="btn-nueva" class="px-4 py-2 rounded-full text-base sm:text-lg font-semibold bg-sky-600 text-white hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-sky-400">Nueva operaci√≥n</button>
        </div>
      </div>

      <!-- Selector de tabla -->
      <div id="selector-tabla" class="hidden mb-6">
        <p class="mb-2 text-lg sm:text-xl font-semibold">Practicar la tabla de:</p>
        <div class="grid grid-cols-6 sm:grid-cols-12 gap-2">
          <!-- Botones 1‚Äì12 -->
          <script>
            // se rellena m√°s abajo si JS desactivado no importa visual
          </script>
        </div>
      </div>

      <!-- Tarjeta de ejercicio -->
      <div id="card" class="rounded-3xl border border-slate-200/60 dark:border-white/10 bg-gradient-to-br from-white to-slate-50 dark:from-slate-800 dark:to-slate-800/80 p-6 sm:p-8">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-6">
          <div class="flex-1 text-center sm:text-left">
            <p class="text-xl sm:text-2xl opacity-80">¬øCu√°nto es‚Ä¶?</p>
            <div class="mt-2 text-6xl sm:text-7xl font-black tabular-nums">
              <span id="n1">3</span>
              <span class="mx-2 sm:mx-3 text-indigo-600 dark:text-indigo-400">√ó</span>
              <span id="n2">4</span>
              <span class="mx-2 sm:mx-3">=</span>
            </div>
          </div>

          <div class="flex-1 w-full">
            <label for="respuesta" class="sr-only">Tu respuesta</label>
            <input id="respuesta" type="number" inputmode="numeric"
                   class="w-full text-center text-4xl sm:text-5xl font-extrabold px-4 py-4 rounded-2xl border-2 border-slate-300 focus:outline-none focus:ring-4 focus:ring-indigo-300 dark:bg-slate-900 dark:border-slate-600"
                   placeholder="Escribe el resultado" />
            <div class="mt-4 flex items-center gap-3 justify-center sm:justify-start">
              <button id="btn-comprobar" class="px-5 py-3 rounded-2xl text-xl font-bold bg-emerald-600 text-white hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-emerald-400">Comprobar</button>
              <button id="btn-saltar" class="px-5 py-3 rounded-2xl text-xl font-bold bg-amber-500 text-white hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-amber-300" title="Mostrar otra operaci√≥n">Saltar</button>
            </div>
          </div>
        </div>

        <!-- Mensaje -->
        <p id="mensaje" class="mt-6 text-center sm:text-left text-2xl sm:text-3xl font-bold"></p>
      </div>

      <!-- Marcador -->
      <div class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-3">
        <div class="rounded-2xl p-4 bg-indigo-600/10 dark:bg-indigo-400/10 text-center">
          <p class="text-sm opacity-80">Aciertos</p>
          <p id="ok" class="text-3xl sm:text-4xl font-black tabular-nums">0</p>
        </div>
        <div class="rounded-2xl p-4 bg-rose-600/10 dark:bg-rose-400/10 text-center">
          <p class="text-sm opacity-80">Fallos</p>
          <p id="ko" class="text-3xl sm:text-4xl font-black tabular-nums">0</p>
        </div>
        <div class="rounded-2xl p-4 bg-emerald-600/10 dark:bg-emerald-400/10 text-center">
          <p class="text-sm opacity-80">Porcentaje</p>
          <p class="text-3xl sm:text-4xl font-black tabular-nums"><span id="pct">0</span>%</p>
        </div>
        <div class="rounded-2xl p-4 bg-amber-500/10 text-center">
          <p class="text-sm opacity-80">Racha</p>
          <p id="streak" class="text-3xl sm:text-4xl font-black tabular-nums">0 üî•</p>
        </div>
      </div>
    </section>

    <!-- Instrucciones -->
    <section class="mt-10 sm:mt-14 bubble rounded-3xl bg-white/80 dark:bg-white/5 backdrop-blur p-5 sm:p-8">
      <h2 class="text-2xl sm:text-3xl font-extrabold mb-3">C√≥mo usar esta aplicaci√≥n</h2>
      <ol class="list-decimal ms-5 text-lg sm:text-xl space-y-2">
        <li>Pulsa <strong>Aleatorio</strong> para practicar mezclado o <strong>Elegir tabla</strong> para centrarte en una tabla del <strong>1 al 12</strong>.</li>
        <li>Escribe el resultado y pulsa <strong>Comprobar</strong> o la tecla <kbd class="px-2 py-1 bg-slate-200 dark:bg-slate-700 rounded">Enter</kbd>.</li>
        <li>Ver√°s un mensaje de acierto o error. Usa <strong>Nueva operaci√≥n</strong> o <strong>Saltar</strong> para otra.</li>
        <li>Los contadores de <em>aciertos</em>, <em>fallos</em>, <em>porcentaje</em> y <em>racha</em> se actualizan autom√°ticamente.</li>
        <li>Para empezar de cero, pulsa <strong>Reiniciar</strong>.</li>
        <li>Solo necesitas este archivo. Abre el <strong>.html</strong> con doble clic. (Requiere conexi√≥n para cargar Tailwind del CDN.)</li>
      </ol>
    </section>
  </main>

  <!-- L√≥gica de la app -->
  <script>
    // --- Estado ---
    const state = {
      modo: 'aleatorio',   // 'aleatorio' | 'tabla'
      tablaFija: null,     // n√∫mero 1..12 cuando modo 'tabla'
      n1: 0, n2: 0,
      ok: 0, ko: 0, streak: 0,
      bloqueado: false
    };

    // --- Utilidades ---
    const $ = (sel) => document.querySelector(sel);
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const playConfetti = () => {
      const zone = $("#confetti");
      zone.innerHTML = "";
      const colors = ["#22c55e","#3b82f6","#f59e0b","#a855f7","#ef4444","#06b6d4"];
      for (let i = 0; i < 60; i++) {
        const p = document.createElement("i");
        p.style.left = rand(0, 100) + "vw";
        p.style.background = colors[rand(0, colors.length - 1)];
        p.style.transform = `translateY(0) rotate(${rand(0,360)}deg)`;
        p.style.animationDelay = (i * 0.01) + "s";
        zone.appendChild(p);
      }
      setTimeout(() => zone.innerHTML = "", 1600);
    };
    const updateScore = () => {
      $("#ok").textContent = state.ok;
      $("#ko").textContent = state.ko;
      const total = state.ok + state.ko;
      $("#pct").textContent = total ? Math.round((state.ok / total) * 100) : 0;
      $("#streak").textContent = state.streak + " üî•";
      try {
        localStorage.setItem("mult-estado", JSON.stringify({
          ok: state.ok, ko: state.ko, streak: state.streak
        }));
      } catch {}
    };
    const loadScore = () => {
      try {
        const saved = JSON.parse(localStorage.getItem("mult-estado") || "null");
        if (saved) {
          state.ok = saved.ok || 0;
          state.ko = saved.ko || 0;
          state.streak = saved.streak || 0;
          updateScore();
        }
      } catch {}
    };

    // --- Generaci√≥n de operaci√≥n ---
    function nuevaOperacion() {
      const a = state.modo === 'tabla' && state.tablaFija ? state.tablaFija : rand(1,12);
      const b = rand(1,12);
      // Para que "tabla" se comporte como X √ó (1..12)
      state.n1 = a; state.n2 = b;
      $("#n1").textContent = state.n1;
      $("#n2").textContent = state.n2;
      $("#respuesta").value = "";
      $("#mensaje").textContent = "";
      $("#respuesta").focus();
      $("#card").classList.remove("shake");
    }

    // --- Comprobaci√≥n ---
    function comprobar() {
      if (state.bloqueado) return;
      const val = parseInt($("#respuesta").value, 10);
      const correct = state.n1 * state.n2;
      if (isNaN(val)) {
        $("#mensaje").textContent = "‚ö†Ô∏è Escribe tu respuesta.";
        $("#card").classList.add("shake");
        setTimeout(() => $("#card").classList.remove("shake"), 380);
        return;
      }
      state.bloqueado = true;
      if (val === correct) {
        state.ok++; state.streak++;
        $("#mensaje").textContent = "üéâ ¬°Correcto! ¬°S√∫per!";
        playConfetti();
        $("#card").classList.add("pop");
        setTimeout(() => $("#card").classList.remove("pop"), 260);
        updateScore();
        setTimeout(() => { state.bloqueado = false; nuevaOperacion(); }, 700);
      } else {
        state.ko++; state.streak = 0;
        $("#mensaje").innerHTML = `‚ùå No es. La respuesta correcta es <strong>${correct}</strong>.`;
        $("#card").classList.add("shake");
        updateScore();
        setTimeout(() => { state.bloqueado = false; }, 380);
      }
    }

    // --- Interacci√≥n UI ---
    function initSelectorTabla() {
      const grid = document.querySelector("#selector-tabla .grid");
      grid.innerHTML = "";
      for (let i = 1; i <= 12; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = "px-4 py-3 rounded-2xl font-bold text-lg bg-white/70 dark:bg-slate-800 border border-slate-200 dark:border-white/10 hover:brightness-105 focus:outline-none focus:ring-2 focus:ring-emerald-400";
        btn.addEventListener("click", () => {
          state.modo = "tabla";
          state.tablaFija = i;
          $("#modo-tabla").classList.add("brightness-110");
          $("#modo-aleatorio").classList.remove("brightness-110");
          nuevaOperacion();
        });
        grid.appendChild(btn);
      }
    }

    function setModo(m) {
      state.modo = m;
      if (m === "tabla") {
        $("#selector-tabla").classList.remove("hidden");
        $("#modo-tabla").classList.add("brightness-110");
        $("#modo-aleatorio").classList.remove("brightness-110");
        if (!state.tablaFija) state.tablaFija = 1;
      } else {
        $("#selector-tabla").classList.add("hidden");
        $("#modo-aleatorio").classList.add("brightness-110");
        $("#modo-tabla").classList.remove("brightness-110");
      }
      nuevaOperacion();
    }

    // --- Eventos ---
    window.addEventListener("DOMContentLoaded", () => {
      loadScore();
      initSelectorTabla();
      setModo("aleatorio");
      $("#btn-comprobar").addEventListener("click", comprobar);
      $("#btn-saltar").addEventListener("click", nuevaOperacion);
      $("#btn-nueva").addEventListener("click", nuevaOperacion);
      $("#btn-reset").addEventListener("click", () => {
        state.ok = 0; state.ko = 0; state.streak = 0; updateScore();
        $("#mensaje").textContent = "üîÑ Contadores reiniciados. ¬°A por m√°s!";
        $("#respuesta").focus();
      });
      $("#modo-aleatorio").addEventListener("click", () => setModo("aleatorio"));
      $("#modo-tabla").addEventListener("click", () => setModo("tabla"));
      $("#respuesta").addEventListener("keydown", (e) => {
        if (e.key === "Enter") comprobar();
      });
    });
  </script>
</body>
</html>
